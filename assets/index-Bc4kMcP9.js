var M=Object.defineProperty;var B=(c,t,e)=>t in c?M(c,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):c[t]=e;var d=(c,t,e)=>B(c,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const h of n.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function e(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(r){if(r.ep)return;r.ep=!0;const n=e(r);fetch(r.href,n)}})();var u=(c=>(c[c.EMPTY=0]="EMPTY",c[c.PAWN=1]="PAWN",c[c.KNIGHT=2]="KNIGHT",c[c.BISHOP=3]="BISHOP",c[c.ROOK=4]="ROOK",c[c.QUEEN=5]="QUEEN",c[c.KING=6]="KING",c))(u||{}),f=(c=>(c[c.WHITE=0]="WHITE",c[c.BLACK=1]="BLACK",c))(f||{});const m=8,g=75,O={0:{0:"",1:"♙",2:"♘",3:"♗",4:"♖",5:"♕",6:"♔"},1:{0:"",1:"♟",2:"♞",3:"♝",4:"♜",5:"♛",6:"♚"}},y={0:0,1:100,2:320,3:330,4:500,5:900,6:2e4};class w{constructor(t,e){d(this,"type");d(this,"color");d(this,"hasMoved");this.type=t,this.color=e,this.hasMoved=!1}}class P extends w{constructor(t){super(u.PAWN,t)}getPseudoLegalMoves(t,e,s){const r=[],n=this.color===f.WHITE?-1:1,h=this.color===f.WHITE?6:1,l=e+n;if(t.isValidSquare(l,s)&&t.isEmpty(l,s)){r.push({row:l,col:s});const i=e+n*2;e===h&&t.isValidSquare(i,s)&&t.isEmpty(i,s)&&r.push({row:i,col:s})}const o=[s-1,s+1];for(const i of o)if(t.isValidSquare(l,i)){const a=t.getPiece(l,i);a&&a.color!==this.color&&r.push({row:l,col:i})}return r}}class L extends w{constructor(t){super(u.KNIGHT,t)}getPseudoLegalMoves(t,e,s){const r=[],n=[[-2,-1],[-2,1],[-1,-2],[-1,2],[1,-2],[1,2],[2,-1],[2,1]];for(const[h,l]of n){const o=e+h,i=s+l;if(t.isValidSquare(o,i)){const a=t.getPiece(o,i);(!a||a.color!==this.color)&&r.push({row:o,col:i})}}return r}}class H extends w{constructor(t){super(u.BISHOP,t)}getPseudoLegalMoves(t,e,s){return I(t,e,s,this.color,[[-1,-1],[-1,1],[1,-1],[1,1]])}}class N extends w{constructor(t){super(u.ROOK,t)}getPseudoLegalMoves(t,e,s){return I(t,e,s,this.color,[[-1,0],[1,0],[0,-1],[0,1]])}}class q extends w{constructor(t){super(u.QUEEN,t)}getPseudoLegalMoves(t,e,s){return I(t,e,s,this.color,[[-1,-1],[-1,1],[1,-1],[1,1],[-1,0],[1,0],[0,-1],[0,1]])}}class k extends w{constructor(t){super(u.KING,t)}getPseudoLegalMoves(t,e,s){const r=[],n=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];for(const[h,l]of n){const o=e+h,i=s+l;if(t.isValidSquare(o,i)){const a=t.getPiece(o,i);(!a||a.color!==this.color)&&r.push({row:o,col:i})}}return r}}function I(c,t,e,s,r){const n=[];for(const[h,l]of r){let o=t+h,i=e+l;for(;c.isValidSquare(o,i);){const a=c.getPiece(o,i);if(!a)n.push({row:o,col:i});else{a.color!==s&&n.push({row:o,col:i});break}o+=h,i+=l}}return n}function S(c,t){switch(c){case u.PAWN:return new P(t);case u.KNIGHT:return new L(t);case u.BISHOP:return new H(t);case u.ROOK:return new N(t);case u.QUEEN:return new q(t);case u.KING:return new k(t);default:return null}}class C{constructor(){d(this,"grid");d(this,"turn");d(this,"isGameOver");this.grid=Array(m).fill(null).map(()=>Array(m).fill(null)),this.turn=f.WHITE,this.isGameOver=!1,this.reset()}reset(){this.grid=Array(m).fill(null).map(()=>Array(m).fill(null)),this.turn=f.WHITE,this.isGameOver=!1,this.setupBoard()}setupBoard(){for(let e=0;e<m;e++)this.grid[1][e]=S(u.PAWN,f.BLACK),this.grid[6][e]=S(u.PAWN,f.WHITE);const t=[u.ROOK,u.KNIGHT,u.BISHOP,u.QUEEN,u.KING,u.BISHOP,u.KNIGHT,u.ROOK];for(let e=0;e<m;e++)this.grid[0][e]=S(t[e],f.BLACK),this.grid[7][e]=S(t[e],f.WHITE)}isValidSquare(t,e){return t>=0&&t<m&&e>=0&&e<m}isEmpty(t,e){return this.grid[t][e]===null}getPiece(t,e){return this.isValidSquare(t,e)?this.grid[t][e]:null}clone(){const t=new C;return t.grid=this.grid.map(e=>e.map(s=>{if(!s)return null;const r=S(s.type,s.color);return r&&(r.hasMoved=s.hasMoved),r})),t.turn=this.turn,t.isGameOver=this.isGameOver,t}makeMove(t){const{fromRow:e,fromCol:s,toRow:r,toCol:n}=t,h=this.grid[e][s];h&&(this.grid[r][n]=h,this.grid[e][s]=null,h.hasMoved=!0,h.type===u.PAWN&&(h.color===f.WHITE&&r===0||h.color===f.BLACK&&r===7)&&(this.grid[r][n]=S(u.QUEEN,h.color)),this.turn=this.turn===f.WHITE?f.BLACK:f.WHITE)}getLegalMoves(t){const e=[];for(let s=0;s<m;s++)for(let r=0;r<m;r++){const n=this.grid[s][r];if(n&&n.color===t){const h=n.getPseudoLegalMoves(this,s,r);for(const l of h){const o=this.clone();o.makeMove({fromRow:s,fromCol:r,toRow:l.row,toCol:l.col}),o.isInCheck(t)||e.push({fromRow:s,fromCol:r,toRow:l.row,toCol:l.col})}}}return e}isInCheck(t){let e=-1,s=-1;for(let o=0;o<m;o++)for(let i=0;i<m;i++){const a=this.grid[o][i];if(a&&a.type===u.KING&&a.color===t){e=o,s=i;break}}if(e===-1)return!1;const r=t===f.WHITE?f.BLACK:f.WHITE,n=[[-1,0],[1,0],[0,-1],[0,1],[-1,-1],[-1,1],[1,-1],[1,1]];for(const[o,i]of n){let a=e+o,p=s+i;for(;this.isValidSquare(a,p);){const v=this.grid[a][p];if(v){if(v.color===r){const E=Math.abs(o)===Math.abs(i),x=!E;if(v.type===u.QUEEN||E&&v.type===u.BISHOP||x&&v.type===u.ROOK)return!0}break}a+=o,p+=i}}const h=[[-2,-1],[-2,1],[-1,-2],[-1,2],[1,-2],[1,2],[2,-1],[2,1]];for(const[o,i]of h){const a=e+o,p=s+i;if(this.isValidSquare(a,p)){const v=this.grid[a][p];if(v&&v.color===r&&v.type===u.KNIGHT)return!0}}const l=r===f.WHITE?e+1:e-1;if(l>=0&&l<m){if(this.isValidSquare(l,s-1)){const o=this.grid[l][s-1];if(o&&o.color===r&&o.type===u.PAWN)return!0}if(this.isValidSquare(l,s+1)){const o=this.grid[l][s+1];if(o&&o.color===r&&o.type===u.PAWN)return!0}}for(let o=-1;o<=1;o++)for(let i=-1;i<=1;i++){if(o===0&&i===0)continue;const a=e+o,p=s+i;if(this.isValidSquare(a,p)){const v=this.grid[a][p];if(v&&v.color===r&&v.type===u.KING)return!0}}return!1}}class K{constructor(t,e){d(this,"canvas");d(this,"ctx");d(this,"board");d(this,"lightSquareColor");d(this,"darkSquareColor");d(this,"selectedSquare");d(this,"validMoves");this.canvas=t;const s=t.getContext("2d");if(!s)throw new Error("Could not get 2d context");this.ctx=s,this.board=e,this.lightSquareColor="#e2e8f0",this.darkSquareColor="#475569",this.selectedSquare=null,this.validMoves=[]}draw(){this.drawBoard(),this.drawHighlights(),this.drawPieces()}drawBoard(){for(let t=0;t<m;t++)for(let e=0;e<m;e++){const s=(t+e)%2===0;this.ctx.fillStyle=s?this.lightSquareColor:this.darkSquareColor,this.ctx.fillRect(e*g,t*g,g,g),e===0&&(this.ctx.fillStyle=s?this.darkSquareColor:this.lightSquareColor,this.ctx.font="10px Arial",this.ctx.fillText(String(8-t),2,t*g+12)),t===7&&(this.ctx.fillStyle=s?this.darkSquareColor:this.lightSquareColor,this.ctx.fillText(String.fromCharCode(97+e),e*g+g-10,597))}}drawHighlights(){this.selectedSquare&&(this.ctx.fillStyle="rgba(255, 255, 0, 0.5)",this.ctx.fillRect(this.selectedSquare.col*g,this.selectedSquare.row*g,g,g)),this.ctx.fillStyle="rgba(100, 255, 100, 0.5)";for(const t of this.validMoves){const e=t.col*g+g/2,s=t.row*g+g/2;this.ctx.beginPath(),this.ctx.arc(e,s,g/6,0,Math.PI*2),this.ctx.fill()}}drawPieces(){this.ctx.font=`${g*.8}px 'Arial'`,this.ctx.textAlign="center",this.ctx.textBaseline="middle";for(let t=0;t<m;t++)for(let e=0;e<m;e++){const s=this.board.grid[t][e];if(s){const r=O[s.color][s.type],n=e*g+g/2,h=t*g+g/2+5;s.color===f.WHITE?(this.ctx.fillStyle="#ffffff",this.ctx.shadowColor="black",this.ctx.shadowBlur=4):(this.ctx.fillStyle="#000000",this.ctx.shadowColor="white",this.ctx.shadowBlur=0),this.ctx.fillText(r,n,h),this.ctx.shadowBlur=0}}}updateSelection(t,e,s){this.selectedSquare={row:t,col:e},this.validMoves=s.map(r=>({row:r.toRow,col:r.toCol})),this.draw()}clearSelection(){this.selectedSquare=null,this.validMoves=[],this.draw()}}class W{constructor(t){d(this,"color");d(this,"depth");this.color=t,this.depth=3}setDifficulty(t){this.depth=parseInt(t)+1}makeMove(t,e){setTimeout(()=>{const s=this.minimaxRoot(t,this.depth,!0);e(s)},100)}evaluateBoard(t){let e=0;for(let s=0;s<m;s++)for(let r=0;r<m;r++){const n=t.grid[s][r];if(n){const h=y[n.type];n.color===this.color?(e+=h,s>=3&&s<=4&&r>=3&&r<=4&&(e+=10)):(e-=h,s>=3&&s<=4&&r>=3&&r<=4&&(e-=10))}}return e}minimaxRoot(t,e,s){const r=t.getLegalMoves(this.color);let n=-9999,h=null;r.sort(()=>Math.random()-.5);for(let l=0;l<r.length;l++){const o=r[l],i=t.clone();i.makeMove(o);const a=this.minimax(i,e-1,-1e5,1e5,!s);a>=n&&(n=a,h=o)}return h}minimax(t,e,s,r,n){if(e===0)return this.evaluateBoard(t);const h=n?this.color:this.color===f.WHITE?f.BLACK:f.WHITE,l=t.getLegalMoves(h);if(l.length===0)return t.isInCheck(h)?n?-99999:99999:0;if(n){let o=-99999;for(let i=0;i<l.length;i++){const a=t.clone();if(a.makeMove(l[i]),o=Math.max(o,this.minimax(a,e-1,s,r,!n)),s=Math.max(s,o),r<=s)return o}return o}else{let o=99999;for(let i=0;i<l.length;i++){const a=t.clone();if(a.makeMove(l[i]),o=Math.min(o,this.minimax(a,e-1,s,r,!n)),r=Math.min(r,o),r<=s)return o}return o}}}class A{constructor(){d(this,"canvas");d(this,"board");d(this,"renderer");d(this,"ai");d(this,"turnIndicator");d(this,"gameStatus");d(this,"restartBtn");d(this,"aiDifficulty");d(this,"playerColor");d(this,"isProcessing");const t=document.getElementById("chessBoard");if(!t)throw new Error("Canvas not found");this.canvas=t,this.board=new C,this.renderer=new K(this.canvas,this.board),this.ai=new W(f.BLACK),this.turnIndicator=document.getElementById("turnIndicator"),this.gameStatus=document.getElementById("gameStatus"),this.restartBtn=document.getElementById("restartBtn"),this.aiDifficulty=document.getElementById("aiDifficulty"),this.setupEventListeners(),this.restartBtn.addEventListener("click",()=>this.restart()),this.aiDifficulty.addEventListener("change",e=>{const s=e.target;this.ai.setDifficulty(s.value)}),this.playerColor=f.WHITE,this.isProcessing=!1}start(){this.renderer.draw(),this.updateUI()}restart(){this.board.reset(),this.isProcessing=!1,this.renderer.clearSelection(),this.updateUI()}setupEventListeners(){this.canvas.addEventListener("mousedown",t=>this.handleClick(t))}handleClick(t){if(this.board.turn!==this.playerColor||this.isProcessing||this.board.isGameOver)return;const e=this.canvas.getBoundingClientRect(),s=this.canvas.width/e.width,r=this.canvas.height/e.height,n=(t.clientX-e.left)*s,h=(t.clientY-e.top)*r,l=Math.floor(n/g),o=Math.floor(h/g);if(this.renderer.selectedSquare)if(this.renderer.validMoves.find(a=>a.row===o&&a.col===l))this.executeMove({fromRow:this.renderer.selectedSquare.row,fromCol:this.renderer.selectedSquare.col,toRow:o,toCol:l}),this.renderer.clearSelection();else{const a=this.board.getPiece(o,l);a&&a.color===this.playerColor?this.selectPiece(o,l):this.renderer.clearSelection()}else{const i=this.board.getPiece(o,l);i&&i.color===this.playerColor&&this.selectPiece(o,l)}}selectPiece(t,e){const r=this.board.getLegalMoves(this.playerColor).filter(n=>n.fromRow===t&&n.fromCol===e);this.renderer.updateSelection(t,e,r)}executeMove(t){this.board.makeMove(t),this.renderer.draw(),!this.checkGameOver()&&(this.isProcessing=!0,this.updateUI(),setTimeout(()=>{this.board.turn===this.ai.color&&this.ai.makeMove(this.board,e=>{e&&(this.board.makeMove(e),this.renderer.draw(),this.checkGameOver()),this.isProcessing=!1,this.updateUI()})},100))}checkGameOver(){if(this.board.isInCheck(this.board.turn)){if(this.board.getLegalMoves(this.board.turn).length===0)return this.board.isGameOver=!0,this.updateUI(`Checkmate! ${this.board.turn===f.WHITE?"Black":"White"} Wins`),!0}else if(this.board.getLegalMoves(this.board.turn).length===0)return this.board.isGameOver=!0,this.updateUI("Stalemate!"),!0;return!1}updateUI(t=null){if(t){this.gameStatus.textContent=t,this.turnIndicator.textContent="Game Over";return}const e=this.board.turn===f.WHITE?"White":"Black";this.turnIndicator.textContent=`${e}'s Turn`,this.board.isInCheck(this.board.turn)?this.gameStatus.textContent="Check!":this.gameStatus.textContent="Game Active"}}document.addEventListener("DOMContentLoaded",()=>{new A().start()});
